# GOKIGEN MOOD ユーザー体験フロー図

## メインフロー図

```mermaid
graph TD
    subgraph "ユーザー"
        U1[ページにアクセス]
        U2[フレームをクリック]
        U3[サンプル写真ボタンクリック]
        U4[編集ボタンクリック]
        U5[フィルター調整]
        U6[トリミング操作]
        U7[保存ボタンクリック]
        U8[DPI選択]
        U9[ダウンロードボタンクリック]
        U10[リセットボタンクリック]
    end

    subgraph "システム"
        S1[ページ初期化]
        S2[ファイル選択ダイアログ表示]
        S3[サンプル写真読み込み]
        S4[写真ファイル検証]
        S5[編集モーダル表示]
        S6[フィルター処理]
        S7[トリミング処理]
        S8[編集内容保存]
        S9[DPI設定適用]
        S10[JPEG生成・ダウンロード]
        S11[ページリセット]
    end

    subgraph "UI"
        UI1[3つのフレーム表示]
        UI2[プレースホルダー表示]
        UI3[写真プレビュー表示]
        UI4[編集・削除ボタン表示]
        UI5[写真切り替えタブ表示]
        UI6[フィルターコントロール表示]
        UI7[トリミングコントロール表示]
        UI8[リアルタイムプレビュー更新]
        UI9[DPI選択UI表示]
        UI10[ダウンロード完了表示]
    end

    %% メインフロー
    U1 --> S1
    S1 --> UI1
    UI1 --> UI2

    %% 写真アップロード分岐
    UI2 --> U2
    UI2 --> U3

    %% ファイル選択フロー
    U2 --> S2
    S2 --> S4
    S4 -->|成功| S3
    S4 -->|失敗| UI2

    %% サンプル写真フロー
    U3 --> S3
    S3 -->|成功| UI3
    S3 -->|失敗| UI2

    %% 写真表示
    UI3 --> UI4

    %% 編集フロー
    UI4 --> U4
    U4 --> S5
    S5 --> UI5
    UI5 --> U5
    U5 --> S6
    S6 --> UI6
    UI6 --> U6
    U6 --> S7
    S7 --> UI7
    UI7 --> U7
    U7 --> S8
    S8 --> UI8

    %% プレビュー確認
    UI8 --> U8
    U8 --> S9
    S9 --> UI9

    %% ダウンロードフロー
    UI9 --> U9
    U9 --> S10
    S10 -->|成功| UI10
    S10 -->|失敗| UI9

    %% リセットフロー
    UI10 --> U10
    U10 --> S11
    S11 --> UI1

    %% エラーハンドリング
    S4 -->|ファイル形式エラー| UI2
    S4 -->|ファイルサイズエラー| UI2
    S3 -->|ネットワークエラー| UI2
    S5 -->|モーダル表示エラー| UI4
    S6 -->|フィルター適用エラー| UI6
    S8 -->|保存エラー| UI7
    S10 -->|ブラウザ非対応| UI9
    S10 -->|メモリ不足| UI9
    S10 -->|ファイル生成エラー| UI9
```

## データフロー図

```mermaid
graph LR
    subgraph "入力データ"
        A[画像ファイル<br/>JPEG/PNG/WebP]
        B[編集パラメータ<br/>フィルター/トリミング]
        C[DPI設定<br/>72/150/300]
    end

    subgraph "処理エンジン"
        D[FileReader API]
        E[Canvas 2D Context]
        F[画像処理アルゴリズム]
        G[JPEG JFIF ヘッダー操作]
    end

    subgraph "出力データ"
        H[プレビュー画像]
        I[編集済み画像]
        J[高品質JPEGファイル]
    end

    A --> D
    D --> E
    E --> F
    B --> F
    F --> G
    C --> G
    G --> H
    G --> I
    G --> J
```

## 状態遷移図

```mermaid
stateDiagram-v2
    [*] --> 初期状態: ページ読み込み

    初期状態 --> 写真選択中: フレームクリック
    初期状態 --> サンプル読み込み中: サンプルボタンクリック

    写真選択中 --> 写真表示中: ファイル選択成功
    写真選択中 --> 初期状態: ファイル選択キャンセル

    サンプル読み込み中 --> 写真表示中: 読み込み成功
    サンプル読み込み中 --> 初期状態: 読み込み失敗

    写真表示中 --> 編集中: 編集ボタンクリック
    写真表示中 --> 初期状態: 削除ボタンクリック

    編集中 --> フィルター調整中: フィルター選択
    編集中 --> トリミング中: トリミングボタンクリック
    編集中 --> 写真表示中: 保存ボタンクリック
    編集中 --> 写真表示中: キャンセルボタンクリック

    フィルター調整中 --> 編集中: 調整完了
    トリミング中 --> 編集中: 操作完了

    写真表示中 --> ダウンロード準備中: ダウンロードボタンクリック
    ダウンロード準備中 --> ダウンロード中: DPI選択
    ダウンロード中 --> 完了: ダウンロード成功
    ダウンロード中 --> ダウンロード準備中: ダウンロード失敗

    完了 --> 初期状態: リセットボタンクリック
```

## UI 構造図

```mermaid
graph TB
    subgraph "ヘッダーセクション"
        H1[GOKIGEN MOOD タイトル]
        H2[DPI選択セレクトボックス]
    end

    subgraph "メインエリア"
        M1[写真フレーム1 - A4版<br/>210×297mm]
        M2[写真フレーム2 - L版<br/>89×127mm]
        M3[写真フレーム3 - L版<br/>127×89mm]
        M4[サンプル写真ボタン]
        M5[リセットボタン]
    end

    subgraph "編集モーダル"
        E1[写真プレビューエリア]
        E2[写真切り替えタブ<br/>写真1 | 写真2 | 写真3]
        E3[左右矢印ボタン<br/>← | →]
        E4[フィルターコントロール<br/>デュオトーン・色調調整]
        E5[トリミングコントロール<br/>ドラッグ・ズーム]
        E6[保存・キャンセルボタン]
    end

    subgraph "ダウンロードセクション"
        D1[個別ダウンロードボタン]
        D2[一括ダウンロードボタン]
    end

    H1 --> M1
    H2 --> M1
    M1 --> M2
    M2 --> M3
    M3 --> M4
    M4 --> M5
    M1 --> E1
    E1 --> E2
    E2 --> E3
    E3 --> E4
    E4 --> E5
    E5 --> E6
    E6 --> D1
    D1 --> D2
```

## 機能マップ

```mermaid
graph TD
    A[GOKIGEN MOOD ツール] --> B[写真管理]
    A --> C[編集機能]
    A --> D[プレビュー機能]
    A --> E[ダウンロード機能]

    B --> B1[アップロード]
    B --> B2[削除]
    B --> B3[切り替え]
    B1 --> B1a[ドラッグ&ドロップ]
    B1 --> B1b[ファイル選択]
    B1 --> B1c[サンプル写真]

    C --> C1[フィルター]
    C --> C2[トリミング]
    C --> C3[テキスト]
    C1 --> C1a[デュオトーン]
    C1 --> C1b[色調調整]
    C1 --> C1c[モノトーン]

    D --> D1[リアルタイム表示]
    D --> D2[写真切り替え]
    D --> D3[調整確認]

    E --> E1[DPI選択]
    E --> E2[個別ダウンロード]
    E --> E3[一括ダウンロード]
```

## 技術構成図

```mermaid
graph TB
    subgraph "フロントエンド"
        A[HTML5]
        B[CSS3]
        C[JavaScript ES6+]
    end

    subgraph "API・ライブラリ"
        D[Canvas API]
        E[FileReader API]
        F[Blob/File API]
        G[ドラッグ&ドロップ API]
    end

    subgraph "画像処理"
        H[Image オブジェクト]
        I[Canvas 2D Context]
        J[JPEG JFIF ヘッダー操作]
        K[DPI設定]
    end

    subgraph "UI/UX"
        L[レスポンシブデザイン]
        M[モーダル管理]
        N[イベントハンドリング]
        O[状態管理]
    end

    A --> D
    B --> L
    C --> E
    C --> F
    C --> G
    D --> H
    E --> I
    F --> J
    G --> K
```
